<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>TaskFlow Error Mapping Test</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 800px;
            margin: 0 auto;
            padding: 20px;
            background: #f5f5f5;
        }
        .test-container {
            background: white;
            border-radius: 8px;
            padding: 20px;
            margin: 10px 0;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        .error-display {
            background: #ffebee;
            border: 1px solid #f44336;
            color: #d32f2f;
            padding: 15px;
            border-radius: 4px;
            margin: 10px 0;
            font-weight: 500;
        }
        .success-display {
            background: #e8f5e8;
            border: 1px solid #4caf50;
            color: #2e7d32;
            padding: 15px;
            border-radius: 4px;
            margin: 10px 0;
            font-weight: 500;
        }
        button {
            background: #4A90E2;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 4px;
            cursor: pointer;
            margin: 5px;
        }
        button:hover {
            background: #357abd;
        }
        .log-output {
            background: #1e1e1e;
            color: #fff;
            padding: 10px;
            border-radius: 4px;
            font-family: monospace;
            font-size: 12px;
            max-height: 200px;
            overflow-y: auto;
            margin: 10px 0;
        }
        h1 { color: #4A90E2; }
        h2 { color: #333; border-bottom: 2px solid #4A90E2; padding-bottom: 10px; }
        .test-title { font-weight: bold; color: #333; }
    </style>
</head>
<body>
    <h1>ğŸ§ª TaskFlow - Error Mapping Test Suite</h1>
    <p><strong>Task 2 - Testing:</strong> ×‘×“×™×§×ª ×”×•×“×¢×•×ª ×©×’×™××” ×’× ×¨×™×•×ª ×•×™×“×™×“×•×ª×™×•×ª</p>

    <!-- ===== TEST 1: Network Error ===== -->
    <div class="test-container">
        <h2>Test 1: Network Error (×©×¨×ª ×œ× ×–××™×Ÿ)</h2>
        <div class="test-title">Expected: "×‘×¢×™×” ×–×× ×™×ª ×‘×©×¨×ª. ×× × × ×¡×” ×©×•×‘ ×××•×—×¨ ×™×•×ª×¨."</div>
        <button onclick="testNetworkError()">ğŸŒ Test Network Error</button>
        <div id="network-result"></div>
        <div id="network-log" class="log-output"></div>
    </div>

    <!-- ===== TEST 2: Rate Limit Error ===== -->
    <div class="test-container">
        <h2>Test 2: Rate Limit Error (×™×•×ª×¨ ××“×™ × ×™×¡×™×•× ×•×ª)</h2>
        <div class="test-title">Expected: "×™×•×ª×¨ ××“×™ × ×™×¡×™×•× ×•×ª ×”×ª×—×‘×¨×•×ª. ×× × ×”××ª×Ÿ ××¡×¤×¨ ×“×§×•×ª ×•× ×¡×” ×©×•×‘."</div>
        <button onclick="testRateLimitError()">â° Test Rate Limit</button>
        <div id="rate-result"></div>
        <div id="rate-log" class="log-output"></div>
    </div>

    <!-- ===== TEST 3: Invalid Token Error ===== -->
    <div class="test-container">
        <h2>Test 3: Invalid Token Error (×˜×•×§×Ÿ ×œ× ×ª×§×™×Ÿ)</h2>
        <div class="test-title">Expected: "×‘×¢×™×” ×–×× ×™×ª ×‘×©×¨×ª. ×× × × ×¡×” ×©×•×‘ ×××•×—×¨ ×™×•×ª×¨."</div>
        <button onclick="testInvalidTokenError()">ğŸ” Test Invalid Token</button>
        <div id="token-result"></div>
        <div id="token-log" class="log-output"></div>
    </div>

    <!-- ===== TEST 4: Popup Blocked Error ===== -->
    <div class="test-container">
        <h2>Test 4: Popup Blocked Error (×—×œ×•×Ÿ ×§×•×¤×¥ × ×—×¡×)</h2>
        <div class="test-title">Expected: "×™×•×ª×¨ ××“×™ × ×™×¡×™×•× ×•×ª ×”×ª×—×‘×¨×•×ª. ×× × ×”××ª×Ÿ ××¡×¤×¨ ×“×§×•×ª ×•× ×¡×” ×©×•×‘."</div>
        <button onclick="testPopupBlockedError()">ğŸªŸ Test Popup Blocked</button>
        <div id="popup-result"></div>
        <div id="popup-log" class="log-output"></div>
    </div>

    <!-- ===== TEST 5: Timeout Error ===== -->
    <div class="test-container">
        <h2>Test 5: Timeout Error (×–××Ÿ ×§×¦×•×‘)</h2>
        <div class="test-title">Expected: "×‘×¢×™×” ×–×× ×™×ª ×‘×©×¨×ª. ×× × × ×¡×” ×©×•×‘ ×××•×—×¨ ×™×•×ª×¨."</div>
        <button onclick="testTimeoutError()">â±ï¸ Test Timeout</button>
        <div id="timeout-result"></div>
        <div id="timeout-log" class="log-output"></div>
    </div>

    <script>
        // Import the error mapping function
        function mapAuthErrorToMessage(error, isDevelopment = false) {
            const errorMessage = error?.message || error?.toString() || 'Unknown error';
            const errorCode = error?.code || '';
            
            console.log(`ğŸ” Mapping error: "${errorMessage}" | Code: "${errorCode}"`);
            
            // ×”×•×“×¢×•×ª ×’× ×¨×™×•×ª ×©××•×ª×××•×ª ×œ×™×¢×œ ×‘×‘×¢×™×•×ª ×©×•× ×•×ª
            const GENERIC_MESSAGES = {
                NETWORK_ISSUE: '×‘×¢×™×” ×–×× ×™×ª ×‘×©×¨×ª. ×× × × ×¡×” ×©×•×‘ ×××•×—×¨ ×™×•×ª×¨.',
                RATE_LIMIT: '×™×•×ª×¨ ××“×™ × ×™×¡×™×•× ×•×ª ×”×ª×—×‘×¨×•×ª. ×× × ×”××ª×Ÿ ××¡×¤×¨ ×“×§×•×ª ×•× ×¡×” ×©×•×‘.',
                AUTH_ISSUE: '×™×•×ª×¨ ××“×™ × ×™×¡×™×•× ×•×ª ×”×ª×—×‘×¨×•×ª. ×× × ×”××ª×Ÿ ××¡×¤×¨ ×“×§×•×ª ×•× ×¡×” ×©×•×‘.'
            };
            
            // ×‘×“×™×§×ª ×¡×•×’ ×©×’×™××” ×œ×¤×™ patterns
            const isNetworkError = 
                errorMessage.includes('Failed to fetch') ||
                errorMessage.includes('ERR_NETWORK') ||
                errorMessage.includes('ERR_CONNECTION') ||
                errorMessage.includes('NETWORK_ERROR') ||
                errorMessage.includes('timeout') ||
                errorMessage.includes('TIMEOUT') ||
                errorCode.includes('network') ||
                errorCode.includes('timeout');
                
            const isRateLimitError =
                errorMessage.includes('rate limit') ||
                errorMessage.includes('Too Many Requests') ||
                errorMessage.includes('429') ||
                errorCode.includes('rate-limit') ||
                errorCode.includes('too-many-requests');
                
            const isAuthError =
                errorMessage.includes('unauthorized') ||
                errorMessage.includes('invalid') ||
                errorMessage.includes('expired') ||
                errorMessage.includes('blocked') ||
                errorMessage.includes('popup') ||
                errorMessage.includes('cancelled') ||
                errorCode.includes('auth') ||
                errorCode.includes('popup') ||
                errorCode.includes('invalid');
            
            // ×”×—×–×¨×ª ×”×•×“×¢×” ×’× ×¨×™×ª ××ª××™××”
            if (isRateLimitError) {
                return GENERIC_MESSAGES.RATE_LIMIT;
            } else if (isNetworkError) {
                return GENERIC_MESSAGES.NETWORK_ISSUE;
            } else if (isAuthError) {
                return GENERIC_MESSAGES.AUTH_ISSUE;
            } else {
                // ×‘×¨×™×¨×ª ××—×“×œ ×œ×›×œ ×”×©××¨
                return GENERIC_MESSAGES.NETWORK_ISSUE;
            }
        }

        function logAuthError(error, context) {
            const timestamp = new Date().toISOString();
            const errorInfo = {
                timestamp,
                context,
                message: error?.message || 'Unknown error',
                code: error?.code || 'unknown',
                stack: error?.stack || 'No stack trace'
            };
            
            console.error('ğŸš¨ Auth Error:', errorInfo);
            return errorInfo;
        }

        function getErrorType(error) {
            const errorMessage = error?.message || error?.toString() || '';
            const errorCode = error?.code || '';
            
            if (errorMessage.includes('Failed to fetch') || errorMessage.includes('ERR_NETWORK')) {
                return 'NETWORK_ERROR';
            } else if (errorMessage.includes('rate limit') || errorMessage.includes('429')) {
                return 'RATE_LIMIT_ERROR';
            } else if (errorMessage.includes('popup') || errorMessage.includes('blocked')) {
                return 'POPUP_BLOCKED_ERROR';
            } else if (errorMessage.includes('timeout')) {
                return 'TIMEOUT_ERROR';
            } else if (errorMessage.includes('invalid') || errorMessage.includes('unauthorized')) {
                return 'AUTH_ERROR';
            } else {
                return 'UNKNOWN_ERROR';
            }
        }

        // Test functions
        function testNetworkError() {
            const error = new Error('Failed to fetch');
            const logDiv = document.getElementById('network-log');
            const resultDiv = document.getElementById('network-result');
            
            // Log the error
            const logInfo = logAuthError(error, 'network_test');
            logDiv.innerHTML = JSON.stringify(logInfo, null, 2);
            
            // Get error type
            const errorType = getErrorType(error);
            console.log(`ğŸ” Error type: ${errorType}`);
            
            // Map to user message
            const userMessage = mapAuthErrorToMessage(error, false);
            
            resultDiv.innerHTML = `<div class="error-display">${userMessage}</div>`;
            
            // Validate expected result
            const expected = '×‘×¢×™×” ×–×× ×™×ª ×‘×©×¨×ª. ×× × × ×¡×” ×©×•×‘ ×××•×—×¨ ×™×•×ª×¨.';
            if (userMessage === expected) {
                resultDiv.innerHTML += `<div class="success-display">âœ… PASS - Expected message shown</div>`;
            } else {
                resultDiv.innerHTML += `<div class="error-display">âŒ FAIL - Expected: "${expected}", Got: "${userMessage}"</div>`;
            }
        }

        function testRateLimitError() {
            const error = new Error('Too Many Requests - rate limit exceeded');
            error.code = 'rate-limit-exceeded';
            const logDiv = document.getElementById('rate-log');
            const resultDiv = document.getElementById('rate-result');
            
            const logInfo = logAuthError(error, 'rate_limit_test');
            logDiv.innerHTML = JSON.stringify(logInfo, null, 2);
            
            const errorType = getErrorType(error);
            console.log(`ğŸ” Error type: ${errorType}`);
            
            const userMessage = mapAuthErrorToMessage(error, false);
            resultDiv.innerHTML = `<div class="error-display">${userMessage}</div>`;
            
            const expected = '×™×•×ª×¨ ××“×™ × ×™×¡×™×•× ×•×ª ×”×ª×—×‘×¨×•×ª. ×× × ×”××ª×Ÿ ××¡×¤×¨ ×“×§×•×ª ×•× ×¡×” ×©×•×‘.';
            if (userMessage === expected) {
                resultDiv.innerHTML += `<div class="success-display">âœ… PASS - Expected message shown</div>`;
            } else {
                resultDiv.innerHTML += `<div class="error-display">âŒ FAIL - Expected: "${expected}", Got: "${userMessage}"</div>`;
            }
        }

        function testInvalidTokenError() {
            const error = new Error('Invalid token provided');
            error.code = 'auth/invalid-token';
            const logDiv = document.getElementById('token-log');
            const resultDiv = document.getElementById('token-result');
            
            const logInfo = logAuthError(error, 'invalid_token_test');
            logDiv.innerHTML = JSON.stringify(logInfo, null, 2);
            
            const errorType = getErrorType(error);
            console.log(`ğŸ” Error type: ${errorType}`);
            
            const userMessage = mapAuthErrorToMessage(error, false);
            resultDiv.innerHTML = `<div class="error-display">${userMessage}</div>`;
            
            const expected = '×™×•×ª×¨ ××“×™ × ×™×¡×™×•× ×•×ª ×”×ª×—×‘×¨×•×ª. ×× × ×”××ª×Ÿ ××¡×¤×¨ ×“×§×•×ª ×•× ×¡×” ×©×•×‘.';
            if (userMessage === expected) {
                resultDiv.innerHTML += `<div class="success-display">âœ… PASS - Expected message shown</div>`;
            } else {
                resultDiv.innerHTML += `<div class="error-display">âŒ FAIL - Expected: "${expected}", Got: "${userMessage}"</div>`;
            }
        }

        function testPopupBlockedError() {
            const error = new Error('Popup blocked by browser');
            error.code = 'popup-blocked';
            const logDiv = document.getElementById('popup-log');
            const resultDiv = document.getElementById('popup-result');
            
            const logInfo = logAuthError(error, 'popup_blocked_test');
            logDiv.innerHTML = JSON.stringify(logInfo, null, 2);
            
            const errorType = getErrorType(error);
            console.log(`ğŸ” Error type: ${errorType}`);
            
            const userMessage = mapAuthErrorToMessage(error, false);
            resultDiv.innerHTML = `<div class="error-display">${userMessage}</div>`;
            
            const expected = '×™×•×ª×¨ ××“×™ × ×™×¡×™×•× ×•×ª ×”×ª×—×‘×¨×•×ª. ×× × ×”××ª×Ÿ ××¡×¤×¨ ×“×§×•×ª ×•× ×¡×” ×©×•×‘.';
            if (userMessage === expected) {
                resultDiv.innerHTML += `<div class="success-display">âœ… PASS - Expected message shown</div>`;
            } else {
                resultDiv.innerHTML += `<div class="error-display">âŒ FAIL - Expected: "${expected}", Got: "${userMessage}"</div>`;
            }
        }

        function testTimeoutError() {
            const error = new Error('Request timeout');
            error.code = 'timeout';
            const logDiv = document.getElementById('timeout-log');
            const resultDiv = document.getElementById('timeout-result');
            
            const logInfo = logAuthError(error, 'timeout_test');
            logDiv.innerHTML = JSON.stringify(logInfo, null, 2);
            
            const errorType = getErrorType(error);
            console.log(`ğŸ” Error type: ${errorType}`);
            
            const userMessage = mapAuthErrorToMessage(error, false);
            resultDiv.innerHTML = `<div class="error-display">${userMessage}</div>`;
            
            const expected = '×‘×¢×™×” ×–×× ×™×ª ×‘×©×¨×ª. ×× × × ×¡×” ×©×•×‘ ×××•×—×¨ ×™×•×ª×¨.';
            if (userMessage === expected) {
                resultDiv.innerHTML += `<div class="success-display">âœ… PASS - Expected message shown</div>`;
            } else {
                resultDiv.innerHTML += `<div class="error-display">âŒ FAIL - Expected: "${expected}", Got: "${userMessage}"</div>`;
            }
        }
    </script>
</body>
</html>
